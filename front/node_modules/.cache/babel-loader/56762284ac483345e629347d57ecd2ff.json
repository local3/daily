{"ast":null,"code":"var _jsxFileName = \"/app/src/store/Auth.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from 'react';\nimport { ErrorContext } from '../store/ErrorProvider';\nimport axios from 'axios';\nimport { useHistory } from 'react-router'; // 初期状態登録\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialContext = {\n  currentUser: null,\n  isLoggedIn: false\n}; // Context作成。このAuthContextに他のコンポーネントからアクセスすることで、ログイン情報を持ってこれる\n\nconst AuthContext = /*#__PURE__*/React.createContext(initialContext); // Router.jsで使う。propsにRouter.jsでラップしたコンポーネントたちが入る。\n\nconst AuthProvider = props => {\n  _s();\n\n  // console.log(\"auth\")\n  // URL遷移用\n  const history = useHistory(); // state定義\n\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [currentUser, setCurrentUser] = useState({});\n  const error = useContext(ErrorContext); // 他コンポーネントからauth.loginやauth.logoutの形で呼び出せる。\n  // 呼び出すと、Contextで管理されているログイン情報が更新される\n\n  const login = session => {\n    // setCurrentUser(null)\n    // console.log(isLoggedIn)\n    // console.log(currentUser)\n    axios.post(`/login`, {\n      session: session\n    }).then(res => {\n      setCurrentUser(res.data.data);\n      setIsLoggedIn(true); // console.log(isLoggedIn)\n      // console.log(currentUser)\n\n      history.push('/');\n    });\n  };\n\n  const logout = () => {\n    axios.delete(`/logout`).then(res => {\n      setCurrentUser(null);\n      setIsLoggedIn(false);\n      history.push('/login');\n    });\n  };\n\n  const signup = user => {\n    axios.post(`/users`, {\n      user: user\n    }).then(res => {\n      setCurrentUser(res.data.data);\n      setIsLoggedIn(true);\n      history.push('/');\n    }).catch(err => {\n      console.log('Err', err.message);\n      error.dispatch({\n        msg: err.response.statusText,\n        status: err.response.status\n      });\n    });\n  }; // currentユーザーを取得\n\n\n  const fetchCurrentUser = () => {\n    axios.get(`/current_user`).then(res => {\n      setCurrentUser(res.data.data);\n      res.data.data === null ? setIsLoggedIn(false) : setIsLoggedIn(true);\n    });\n  }; // レンダリング後にユーザーの取得を行う\n\n\n  useEffect(() => {\n    fetchCurrentUser();\n  }, []); // 各コンポーネントに最終的に送る内容\n\n  const value = {\n    currentUser,\n    isLoggedIn,\n    login,\n    logout,\n    signup\n  };\n  return (\n    /*#__PURE__*/\n    // .Providerで値を送り、各コンポーネントでuseContext(AuthContext)で情報を受け取る\n    _jsxDEV(AuthContext.Provider, {\n      value: value,\n      children: props.children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 5\n    }, this)\n  );\n};\n\n_s(AuthProvider, \"ACFkt+T0Sb2L7PzV1qAUjhYKA6Y=\", false, function () {\n  return [useHistory];\n});\n\n_c = AuthProvider;\nexport { AuthContext, AuthProvider };\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/app/src/store/Auth.js"],"names":["React","useState","useEffect","useContext","ErrorContext","axios","useHistory","initialContext","currentUser","isLoggedIn","AuthContext","createContext","AuthProvider","props","history","setIsLoggedIn","setCurrentUser","error","login","session","post","then","res","data","push","logout","delete","signup","user","catch","err","console","log","message","dispatch","msg","response","statusText","status","fetchCurrentUser","get","value","children"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react'\nimport { ErrorContext } from '../store/ErrorProvider'\nimport axios from 'axios'\nimport { useHistory } from 'react-router';\n\n// 初期状態登録\nconst initialContext = {\n  currentUser: null,\n  isLoggedIn: false,\n}\n// Context作成。このAuthContextに他のコンポーネントからアクセスすることで、ログイン情報を持ってこれる\nconst AuthContext = React.createContext(initialContext);\n\n// Router.jsで使う。propsにRouter.jsでラップしたコンポーネントたちが入る。\nconst AuthProvider = (props) => {\n  // console.log(\"auth\")\n  // URL遷移用\n  const history = useHistory();\n  // state定義\n  const [isLoggedIn, setIsLoggedIn] = useState(false)\n  const [currentUser, setCurrentUser] = useState({})\n  const error = useContext(ErrorContext)\n\n  // 他コンポーネントからauth.loginやauth.logoutの形で呼び出せる。\n  // 呼び出すと、Contextで管理されているログイン情報が更新される\n  const login = (session) => {\n    // setCurrentUser(null)\n    // console.log(isLoggedIn)\n    // console.log(currentUser)\n    axios.post(`/login`, { session: session })\n      .then(res => {\n        setCurrentUser(res.data.data)\n        setIsLoggedIn(true)\n        // console.log(isLoggedIn)\n        // console.log(currentUser)\n        history.push('/')\n      })\n  }\n\n  const logout = () => {\n    axios.delete(`/logout`)\n      .then(res => {\n        setCurrentUser(null)\n        setIsLoggedIn(false)\n        history.push('/login')\n      })\n  }\n\n  const signup = (user) => {\n    axios.post(`/users`, { user: user })\n      .then(res => {\n        setCurrentUser(res.data.data)\n        setIsLoggedIn(true)\n        history.push('/')\n      })\n\n      .catch(err => {\n        console.log('Err', err.message)\n        error.dispatch({msg: err.response.statusText, status: err.response.status})\n      })\n  }\n\n  // currentユーザーを取得\n  const fetchCurrentUser = () => {\n    axios.get(`/current_user`)\n      .then(res => {\n        setCurrentUser(res.data.data)\n        res.data.data === null ? setIsLoggedIn(false) : setIsLoggedIn(true)\n      })\n  }\n\n  // レンダリング後にユーザーの取得を行う\n  useEffect(() => {\n    fetchCurrentUser()\n  }, []);\n\n  // 各コンポーネントに最終的に送る内容\n  const value = {currentUser, isLoggedIn, login, logout, signup}\n\n  return (\n    // .Providerで値を送り、各コンポーネントでuseContext(AuthContext)で情報を受け取る\n    <AuthContext.Provider\n      value={value}\n    >\n      { props.children }\n    </AuthContext.Provider>\n  );\n}\n\nexport { AuthContext, AuthProvider };\n"]},"metadata":{},"sourceType":"module"}